<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç»ªæ”¯æŒåŠ©æ‰‹</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        // ç®€å•çš„SVGå›¾æ ‡ç»„ä»¶
        const Heart = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
        );

        const Camera = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                <circle cx="12" cy="13" r="4"/>
            </svg>
        );

        const Mic = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                <line x1="12" y1="19" x2="12" y2="23"/>
                <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
        );

        const MessageCircle = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
            </svg>
        );

        const Globe = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
        );

        // æ–°å¢æ–‡æ¡£å›¾æ ‡
        const FileText = ({ className }) => (
          <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <line x1="10" y1="9" x2="8" y2="9"/>
          </svg>
        );

        // æ–°å¢æ‹–æ‹½æ‰‹æŸ„å›¾æ ‡
        const DragHandle = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="currentColor">
                <path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
        );

        const EmotionalSupportApp = () => {
          const [currentView, setCurrentView] = useState('main');
          const [sosMode, setSosMode] = useState('photo');
          const [mixedMode, setMixedMode] = useState('photo-audio'); // 'photo-audio' æˆ– 'memory-audio'
          const [currentIndex, setCurrentIndex] = useState(0);
          const [language, setLanguage] = useState('zh');
          const [photoDuration, setPhotoDuration] = useState(12);
          const [uploadedAudios, setUploadedAudios] = useState([]);
          const [uploadedPhotos, setUploadedPhotos] = useState([]);
          const [defaultPhotos, setDefaultPhotos] = useState([
            { 
              id: 1, 
              url: 'https://images.unsplash.com/photo-1544027993-37dbfe43562a?w=800&h=600&fit=crop&q=80', 
              description: { zh: 'å’Œå¥½æœ‹å‹çš„åˆç…§', en: 'Photo with good friends' },
              isDefault: true
            },
            { 
              id: 2, 
              url: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=800&h=600&fit=crop&q=80', 
              description: { zh: 'åˆä¸­æ—¶å…‰', en: 'Middle school days' },
              isDefault: true
            },
            { 
              id: 3, 
              url: 'https://images.unsplash.com/photo-1511988617509-a57c8a288659?w=800&h=600&fit=crop&q=80', 
              description: { zh: 'æ¸©æš–çš„å›å¿†', en: 'Warm memories' },
              isDefault: true
            }
          ]);
          const [defaultMemories, setDefaultMemories] = useState([
            { 
              id: 1, 
              title: { zh: 'ç¬¬ä¸€æ¬¡è·å¥–', en: 'First Award' }, 
              content: { zh: 'è®°å¾—é‚£å¤©ä½ ç‰¹åˆ«å¼€å¿ƒï¼Œçœ¼ç›éƒ½åœ¨å‘å…‰', en: 'Remember how happy you were that day, your eyes were shining' },
              isDefault: true
            },
            { 
              id: 2, 
              title: { zh: 'å’Œæœ‹å‹çš„åˆé¤', en: 'Lunch with Friends' }, 
              content: { zh: 'é‚£æ¬¡èŠå¤©èŠåˆ°å¿˜è®°æ—¶é—´ï¼Œä½ ç¬‘å¾—ç‰¹åˆ«ç¿çƒ‚', en: 'That time you chatted until you forgot the time, you smiled so brightly' },
              isDefault: true
            },
            { 
              id: 3, 
              title: { zh: 'å…‹æœå›°éš¾', en: 'Overcoming Challenges' }, 
              content: { zh: 'ä½ æ›¾ç»è§‰å¾—ä¸å¯èƒ½çš„äº‹æƒ…ï¼Œæœ€åéƒ½åšåˆ°äº†', en: 'Things you once thought impossible, you eventually accomplished them all' },
              isDefault: true
            }
          ]);
          const [notepadContent, setNotepadContent] = useState('');
          const [isAudioPlaying, setIsAudioPlaying] = useState(false);
          // æ–°å¢æ‹–æ‹½çŠ¶æ€
          const [draggedItem, setDraggedItem] = useState(null);
          const [dragOverIndex, setDragOverIndex] = useState(null);
          const intervalRef = useRef(null);
          const audioRef = useRef(null);

          // å¤šè¯­è¨€æ–‡æœ¬
          const texts = {
            zh: {
              title: 'æƒ…ç»ªæ”¯æŒåŠ©æ‰‹',
              subtitle: 'ä½ ä¸æ˜¯ä¸€ä¸ªäººï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œé™ªä¼´ä½ ',
              sosButton: 'ğŸ†˜ ç´§æ€¥å®‰æŠš',
              photoMode: 'ğŸ“¸ å®‰å…¨ç…§ç‰‡',
              audioMode: 'ğŸµ æ¸©æš–å£°éŸ³',
              messageMode: 'ğŸ’­ æ­£é¢è®°å¿†',
              mixedMode: 'ğŸ”„ æ··åˆæ¨¡å¼',
              photoAudioMode: 'ğŸ“¸ğŸµ ç…§ç‰‡+éŸ³ä¹',
              memoryAudioMode: 'ğŸ’­ğŸµ æ–‡å­—+éŸ³ä¹',
              safePhotos: 'å®‰å…¨ç…§ç‰‡',
              supportSounds: 'æ”¯æŒå£°éŸ³',
              positiveMemories: 'æ­£é¢è®°å¿†',
              photosCount: 'å¼ ç…§ç‰‡',
              audiosCount: 'æ®µå½•éŸ³',
              memoriesCount: 'ä¸ªå›å¿†',
              stop: 'åœæ­¢',
              back: 'â† è¿”å›',
              yourMemories: 'ä½ çš„ç¾å¥½å›å¿†',
              returnHome: 'è¿”å›ä¸»é¡µ',
              photoDuration: 'ç…§ç‰‡åœç•™æ—¶é—´',
              seconds: 'ç§’',
              minute: 'åˆ†é’Ÿ',
              minutes: 'åˆ†é’Ÿ',
              permanent: 'æ°¸ä¹…',
              photoSettings: 'ç…§ç‰‡è®¾ç½®',
              replay: 'é‡æ’­',
              pause: 'æš‚åœ',
              resume: 'ç»§ç»­'
            },
            en: {
              title: 'Emotional Support Assistant',
              subtitle: 'You are not alone, we are here with you',
              sosButton: 'ğŸ†˜ Emergency Comfort',
              photoMode: 'ğŸ“¸ Safe Photos',
              audioMode: 'ğŸµ Warm Sounds',
              messageMode: 'ğŸ’­ Positive Memories',
              mixedMode: 'ğŸ”„ Mixed Mode',
              photoAudioMode: 'ğŸ“¸ğŸµ Photo+Music',
              memoryAudioMode: 'ğŸ’­ğŸµ Text+Music',
              safePhotos: 'Safe Photos',
              supportSounds: 'Support Sounds',
              positiveMemories: 'Positive Memories',
              photosCount: 'photos',
              audiosCount: 'audios',
              memoriesCount: 'memories',
              stop: 'Stop',
              back: 'â† Back',
              yourMemories: 'Your Beautiful Memories',
              returnHome: 'Return Home',
              photoDuration: 'Photo Duration',
              seconds: 'seconds',
              minute: 'minute',
              minutes: 'minutes',
              permanent: 'Permanent',
              photoSettings: 'Photo Settings',
              replay: 'Replay',
              pause: 'Pause',
              resume: 'Resume'
            }
          };

          const t = texts[language];

          // å›ºå®šçš„ç¤ºä¾‹æ•°æ® - ç°åœ¨ä½¿ç”¨stateç®¡ç†
          // åˆå¹¶é»˜è®¤ç…§ç‰‡å’Œç”¨æˆ·ä¸Šä¼ çš„ç…§ç‰‡
          const allPhotos = [...defaultPhotos, ...uploadedPhotos];

          const defaultMemoryData = defaultMemories;

          // åˆå¹¶é»˜è®¤å›å¿†å’ŒNotepadå†…å®¹
          const allMemories = notepadContent.trim() ? 
            [...defaultMemoryData, {
              id: 'notepad',
              title: { zh: 'æˆ‘çš„å¿ƒçµç¬”è®°', en: 'My Heart Notes' },
              content: { zh: notepadContent, en: notepadContent },
              isNotepad: true
            }] : defaultMemoryData;

          // æ–°å¢æ‹–æ‹½æ’åºåŠŸèƒ½ - é€šç”¨ç‰ˆæœ¬
          const handleDragStart = (e, index, type) => {
            setDraggedItem({ index, type });
            e.dataTransfer.effectAllowed = 'move';
          };

          const handleDragOver = (e, index) => {
            e.preventDefault();
            setDragOverIndex(index);
          };

          const handleDragLeave = () => {
            setDragOverIndex(null);
          };

          const handleDrop = (e, dropIndex, type) => {
            e.preventDefault();
            if (draggedItem !== null && draggedItem.index !== dropIndex && draggedItem.type === type) {
              if (type === 'audio') {
                const newAudios = [...uploadedAudios];
                const draggedAudio = newAudios[draggedItem.index];
                newAudios.splice(draggedItem.index, 1);
                newAudios.splice(dropIndex, 0, draggedAudio);
                setUploadedAudios(newAudios);
              } else if (type === 'photo') {
                const newPhotos = [...allPhotos];
                const draggedPhoto = newPhotos[draggedItem.index];
                newPhotos.splice(draggedItem.index, 1);
                newPhotos.splice(dropIndex, 0, draggedPhoto);
                // åˆ†ç¦»é»˜è®¤å’Œç”¨æˆ·ç…§ç‰‡
                const defaultPhotos = newPhotos.filter(p => p.isDefault);
                const userPhotos = newPhotos.filter(p => !p.isDefault);
                setUploadedPhotos(userPhotos);
              } else if (type === 'memory') {
                const newMemories = [...allMemories];
                const draggedMemory = newMemories[draggedItem.index];
                newMemories.splice(draggedItem.index, 1);
                newMemories.splice(dropIndex, 0, draggedMemory);
                // åˆ†ç¦»é»˜è®¤å’Œç”¨æˆ·å›å¿†
                const userMemories = newMemories.filter(m => !m.isDefault);
                setUploadedMemories(userMemories);
              }
            }
            setDraggedItem(null);
            setDragOverIndex(null);
          };

          const handleDragEnd = () => {
            setDraggedItem(null);
            setDragOverIndex(null);
          };

          // éŸ³é¢‘æ’­æ”¾æ§åˆ¶å‡½æ•°
          const playAudio = (audioUrl) => {
            if (audioRef.current) {
              audioRef.current.src = audioUrl;
              audioRef.current.play().then(() => {
                setIsAudioPlaying(true);
              }).catch(err => {
                alert(language === 'zh' ? 'æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥éŸ³é¢‘æ ¼å¼' : 'Playback failed, check audio format');
              });
            }
          };

          const pauseAudio = () => {
            if (audioRef.current) {
              audioRef.current.pause();
              setIsAudioPlaying(false);
            }
          };

          const resumeAudio = () => {
            if (audioRef.current) {
              audioRef.current.play().then(() => {
                setIsAudioPlaying(true);
              });
            }
          };

          const stopAudio = () => {
            if (audioRef.current) {
              audioRef.current.pause();
              audioRef.current.currentTime = 0;
              setIsAudioPlaying(false);
            }
          };

          // SOSæŒ‰é’®åŠŸèƒ½
          const handleSOS = () => {
            setCurrentIndex(0);
            
            if (sosMode === 'photo') {
              startPhotoSlideshow();
            } else if (sosMode === 'audio') {
              if (uploadedAudios.length > 0) {
                setCurrentView('audio');
                // æœ€å°å»¶è¿Ÿå¯åŠ¨æ’­æ”¾
                setTimeout(() => {
                  const firstAudio = uploadedAudios[0];
                  if (firstAudio && audioRef.current) {
                    audioRef.current.src = firstAudio.audioUrl;
                    audioRef.current.play().then(() => {
                      setIsAudioPlaying(true);
                    }).catch(err => {
                      console.log('åˆå§‹æ’­æ”¾å¤±è´¥ï¼Œé‡è¯•:', err);
                      setTimeout(() => {
                        audioRef.current.play();
                      }, 50);
                    });
                  }
                }, 50); // å‡å°‘åˆ°æœ€å°å»¶è¿Ÿ
              } else {
                setCurrentView('audio');
              }
            } else if (sosMode === 'message') {
              if (allMemories.length > 0) {
                setCurrentView('memories-slideshow');
              } else {
                setCurrentView('memories');
              }
            } else if (sosMode === 'mixed') {
              // æ ¹æ®é€‰æ‹©çš„æ··åˆæ¨¡å¼å¯åŠ¨
              if (mixedMode === 'photo-audio') {
                if (allPhotos.length > 0 && uploadedAudios.length > 0) {
                  setCurrentView('mixed-photo-audio');
                  // å¯åŠ¨ç…§ç‰‡å¹»ç¯ç‰‡å’ŒéŸ³ä¹æ’­æ”¾
                  if (photoDuration > 0) {
                    intervalRef.current = setInterval(() => {
                      setCurrentIndex(prev => (prev + 1) % allPhotos.length);
                    }, photoDuration * 1000);
                  }
                  // å¯åŠ¨éŸ³ä¹æ’­æ”¾
                  setTimeout(() => {
                    const firstAudio = uploadedAudios[0];
                    if (firstAudio && audioRef.current) {
                      audioRef.current.src = firstAudio.audioUrl;
                      audioRef.current.play().then(() => {
                        setIsAudioPlaying(true);
                      }).catch(err => {
                        console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œé‡è¯•:', err);
                        setTimeout(() => {
                          audioRef.current.play();
                        }, 50);
                      });
                    }
                  }, 50);
                } else {
                  alert(language === 'zh' ? 'éœ€è¦åŒæ—¶æœ‰ç…§ç‰‡å’ŒéŸ³é¢‘æ–‡ä»¶æ‰èƒ½ä½¿ç”¨æ­¤æ¨¡å¼' : 'Need both photos and audio files to use this mode');
                }
              } else if (mixedMode === 'memory-audio') {
                if (allMemories.length > 0 && uploadedAudios.length > 0) {
                  setCurrentView('mixed-memory-audio');
                  // å¯åŠ¨éŸ³ä¹æ’­æ”¾
                  setTimeout(() => {
                    const firstAudio = uploadedAudios[0];
                    if (firstAudio && audioRef.current) {
                      audioRef.current.src = firstAudio.audioUrl;
                      audioRef.current.play().then(() => {
                        setIsAudioPlaying(true);
                      }).catch(err => {
                        console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œé‡è¯•:', err);
                        setTimeout(() => {
                          audioRef.current.play();
                        }, 50);
                      });
                    }
                  }, 50);
                } else {
                  alert(language === 'zh' ? 'éœ€è¦åŒæ—¶æœ‰å›å¿†å’ŒéŸ³é¢‘æ–‡ä»¶æ‰èƒ½ä½¿ç”¨æ­¤æ¨¡å¼' : 'Need both memories and audio files to use this mode');
                }
              }
            }
          };

          // æ’­æ”¾ä¸‹ä¸€é¦–éŸ³é¢‘ - ä¼˜åŒ–ä¸ºæœ€å¿«åˆ‡æ¢
          const playNextAudio = () => {
            if (uploadedAudios.length > 1) {
              const nextIndex = (currentIndex + 1) % uploadedAudios.length;
              setCurrentIndex(nextIndex);
              const nextAudio = uploadedAudios[nextIndex];
              if (nextAudio && audioRef.current) {
                // ç«‹å³åˆ‡æ¢ï¼Œæ— å»¶è¿Ÿ
                audioRef.current.src = nextAudio.audioUrl;
                audioRef.current.play().catch(err => {
                  console.log('æ’­æ”¾å¤±è´¥ï¼Œå°è¯•é‡æ–°æ’­æ”¾:', err);
                  // å¦‚æœå¤±è´¥ï¼Œç«‹å³é‡è¯•
                  setTimeout(() => {
                    audioRef.current.play();
                  }, 50);
                });
              }
            } else if (uploadedAudios.length === 1) {
              // å¦‚æœåªæœ‰ä¸€é¦–æ­Œï¼Œç«‹å³é‡æ–°æ’­æ”¾
              if (audioRef.current) {
                audioRef.current.currentTime = 0;
                audioRef.current.play();
              }
            }
          };

          const startPhotoSlideshow = () => {
            setCurrentView('slideshow');
            if (photoDuration > 0) {
              intervalRef.current = setInterval(() => {
                setCurrentIndex(prev => (prev + 1) % allPhotos.length);
              }, photoDuration * 1000);
            }
          };

          const stopSOS = () => {
            if (intervalRef.current) {
              clearInterval(intervalRef.current);
            }
            // ç¡®ä¿å®Œå…¨åœæ­¢éŸ³é¢‘å¹¶é‡ç½®çŠ¶æ€
            if (audioRef.current) {
              audioRef.current.pause();
              audioRef.current.currentTime = 0;
              setIsAudioPlaying(false);
            }
            setCurrentView('main');
          };

          // ä¸»ç•Œé¢
          if (currentView === 'main') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4">
                <div className="max-w-md mx-auto">
                  {/* è¯­è¨€åˆ‡æ¢æŒ‰é’® */}
                  <div className="flex justify-end pt-4 mb-4">
                    <button
                      onClick={() => setLanguage(language === 'zh' ? 'en' : 'zh')}
                      className="flex items-center space-x-2 bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 px-3 py-2 rounded-lg shadow-sm hover:from-pink-100 hover:to-rose-100"
                    >
                      <Globe className="w-4 h-4 text-gray-600" />
                      <span className="text-sm text-gray-600">
                        {language === 'zh' ? 'EN' : 'ä¸­æ–‡'}
                      </span>
                    </button>
                  </div>

                  {/* æ ‡é¢˜ */}
                  <div className="text-center mb-8">
                    <Heart className="w-12 h-12 text-pink-500 mx-auto mb-2" />
                    <h1 className="text-2xl font-bold text-gray-800 mb-2">{t.title}</h1>
                    <p className="text-gray-600">{t.subtitle}</p>
                  </div>

                  {/* SOS æŒ‰é’® */}
                  <div className="mb-8">
                    <button
                      onClick={handleSOS}
                      className="w-full bg-red-500 hover:bg-red-600 text-white text-xl font-bold py-6 px-8 rounded-full shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95"
                    >
                      {t.sosButton}
                    </button>
                    
                    {/* SOS æ¨¡å¼é€‰æ‹© */}
                    <div className="mt-4 grid grid-cols-2 gap-2">
                      <button
                        onClick={() => setSosMode('photo')}
                        className={`py-2 px-4 rounded-lg text-sm transition-colors ${sosMode === 'photo' ? 'bg-blue-500 text-white' : 'bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 text-gray-700'}`}
                      >
                        {t.photoMode}
                      </button>
                      <button
                        onClick={() => setSosMode('audio')}
                        className={`py-2 px-4 rounded-lg text-sm transition-colors ${sosMode === 'audio' ? 'bg-blue-500 text-white' : 'bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 text-gray-700'}`}
                      >
                        {t.audioMode}
                      </button>
                      <button
                        onClick={() => setSosMode('message')}
                        className={`py-2 px-4 rounded-lg text-sm transition-colors ${sosMode === 'message' ? 'bg-blue-500 text-white' : 'bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 text-gray-700'}`}
                      >
                        {t.messageMode}
                      </button>
                      <button
                        onClick={() => setSosMode('mixed')}
                        className={`py-2 px-4 rounded-lg text-sm transition-colors ${sosMode === 'mixed' ? 'bg-blue-500 text-white' : 'bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 text-gray-700'}`}
                      >
                        {t.mixedMode}
                      </button>
                    </div>

                    {/* æ··åˆæ¨¡å¼çš„å­é€‰é¡¹ */}
                    {sosMode === 'mixed' && (
                      <div className="mt-4 p-4 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg">
                        <p className="text-sm text-gray-700 mb-3 text-center font-medium">
                          {language === 'zh' ? 'é€‰æ‹©æ··åˆæ¨¡å¼ç±»å‹:' : 'Choose Mixed Mode Type:'}
                        </p>
                        <div className="grid grid-cols-1 gap-2">
                          <button
                            onClick={() => setMixedMode('photo-audio')}
                            className={`py-3 px-4 rounded-lg text-sm transition-colors ${mixedMode === 'photo-audio' ? 'bg-purple-500 text-white' : 'bg-white border border-purple-200 text-gray-700 hover:bg-purple-50'}`}
                          >
                            {t.photoAudioMode}
                            <p className="text-xs mt-1 opacity-80">
                              {language === 'zh' ? 'åŒæ—¶æ’­æ”¾ç…§ç‰‡å¹»ç¯ç‰‡å’ŒèƒŒæ™¯éŸ³ä¹' : 'Play photo slideshow with background music'}
                            </p>
                          </button>
                          <button
                            onClick={() => setMixedMode('memory-audio')}
                            className={`py-3 px-4 rounded-lg text-sm transition-colors ${mixedMode === 'memory-audio' ? 'bg-purple-500 text-white' : 'bg-white border border-purple-200 text-gray-700 hover:bg-purple-50'}`}
                          >
                            {t.memoryAudioMode}
                            <p className="text-xs mt-1 opacity-80">
                              {language === 'zh' ? 'æ˜¾ç¤ºæ–‡å­—å›å¿†å¹¶æ’­æ”¾èƒŒæ™¯éŸ³ä¹' : 'Show text memories with background music'}
                            </p>
                          </button>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* è®¾ç½®åŒºåŸŸ */}
                  <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-4 rounded-xl shadow-md mb-6">
                    <h3 className="font-semibold text-gray-800 mb-4 text-center">{t.photoSettings}</h3>
                    
                    <div>
                      <p className="text-sm text-gray-600 mb-2">{t.photoDuration}:</p>
                      <div className="grid grid-cols-3 gap-2">
                        {[
                          { value: 10, label: `10 ${t.seconds}` },
                          { value: 20, label: `20 ${t.seconds}` },
                          { value: 60, label: `1 ${t.minute}` },
                          { value: 300, label: `5 ${t.minutes}` },
                          { value: 1800, label: `30 ${t.minutes}` },
                          { value: 0, label: t.permanent }
                        ].map(option => (
                          <button
                            key={option.value}
                            onClick={() => setPhotoDuration(option.value)}
                            className={`py-2 px-2 rounded-lg text-xs transition-colors ${
                              photoDuration === option.value 
                                ? 'bg-blue-500 text-white' 
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {option.label}
                          </button>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* åŠŸèƒ½å¡ç‰‡ */}
                  <div className="grid grid-cols-1 gap-4">
                    <div 
                      onClick={() => setCurrentView('photos')}
                      className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-4 rounded-xl shadow-md cursor-pointer hover:shadow-lg hover:from-pink-100 hover:to-rose-100 transition-all"
                    >
                      <div className="flex items-center">
                        <Camera className="w-8 h-8 text-pink-500 mr-3" />
                        <div>
                          <h3 className="font-semibold text-gray-800">{t.safePhotos}</h3>
                          <p className="text-sm text-gray-600">{allPhotos.length} {t.photosCount}</p>
                        </div>
                      </div>
                    </div>

                    <div 
                      onClick={() => setCurrentView('audios')}
                      className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-4 rounded-xl shadow-md cursor-pointer hover:shadow-lg hover:from-pink-100 hover:to-rose-100 transition-all"
                    >
                      <div className="flex items-center">
                        <Mic className="w-8 h-8 text-pink-500 mr-3" />
                        <div>
                          <h3 className="font-semibold text-gray-800">{t.supportSounds}</h3>
                          <p className="text-sm text-gray-600">{uploadedAudios.length} {t.audiosCount}</p>
                        </div>
                      </div>
                    </div>

                    <div 
                      onClick={() => setCurrentView('memories')}
                      className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-4 rounded-xl shadow-md cursor-pointer hover:shadow-lg hover:from-pink-100 hover:to-rose-100 transition-all"
                    >
                      <div className="flex items-center">
                        <MessageCircle className="w-8 h-8 text-pink-500 mr-3" />
                        <div>
                          <h3 className="font-semibold text-gray-800">{t.positiveMemories}</h3>
                          <p className="text-sm text-gray-600">{allMemories.length} {t.memoriesCount}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // ç…§ç‰‡å¹»ç¯ç‰‡è§†å›¾
          if (currentView === 'slideshow') {
            return (
              <div className="min-h-screen bg-black relative flex items-center justify-center">
                <img
                  src={allPhotos[currentIndex]?.url}
                  alt={allPhotos[currentIndex]?.description[language]}
                  className="max-w-full max-h-full object-contain"
                  style={{
                    maxWidth: '90%',
                    maxHeight: '80%',
                    borderRadius: '12px',
                    boxShadow: '0 10px 30px rgba(0,0,0,0.5)'
                  }}
                />
                <div className="absolute bottom-20 left-0 right-0 text-center">
                  <div className="bg-black bg-opacity-70 mx-4 p-4 rounded-lg">
                    <p className="text-white text-xl mb-4">{allPhotos[currentIndex]?.description[language]}</p>
                    <button
                      onClick={stopSOS}
                      className="bg-white text-black px-6 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors"
                    >
                      {t.stop}
                    </button>
                  </div>
                </div>
                
                <div className="absolute top-4 right-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded-lg">
                  {currentIndex + 1} / {allPhotos.length}
                </div>

                <div className="absolute top-4 left-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded-lg text-sm">
                  {photoDuration === 0 && t.permanent}
                  {photoDuration === 10 && `10 ${t.seconds}`}
                  {photoDuration === 20 && `20 ${t.seconds}`}
                  {photoDuration === 60 && `1 ${t.minute}`}
                  {photoDuration === 300 && `5 ${t.minutes}`}
                  {photoDuration === 1800 && `30 ${t.minutes}`}
                </div>
                
                <button
                  onClick={() => setCurrentIndex((prev) => (prev - 1 + allPhotos.length) % allPhotos.length)}
                  className="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-70 transition-all"
                >
                  â†
                </button>
                <button
                  onClick={() => setCurrentIndex((prev) => (prev + 1) % allPhotos.length)}
                  className="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-70 transition-all"
                >
                  â†’
                </button>
              </div>
            );
          }

          // æ··åˆæ¨¡å¼ï¼šç…§ç‰‡+éŸ³ä¹
          if (currentView === 'mixed-photo-audio') {
            return (
              <div className="min-h-screen bg-black relative flex items-center justify-center">
                <img
                  src={allPhotos[currentIndex]?.url}
                  alt={allPhotos[currentIndex]?.description[language]}
                  className="max-w-full max-h-full object-contain"
                  style={{
                    maxWidth: '90%',
                    maxHeight: '80%',
                    borderRadius: '12px',
                    boxShadow: '0 10px 30px rgba(0,0,0,0.5)'
                  }}
                />
                
                {/* éŸ³ä¹æ§åˆ¶å’Œç…§ç‰‡ä¿¡æ¯ */}
                <div className="absolute bottom-20 left-0 right-0 text-center">
                  <div className="bg-black bg-opacity-70 mx-4 p-4 rounded-lg">
                    <p className="text-white text-xl mb-2">{allPhotos[currentIndex]?.description[language]}</p>
                    
                    {/* å½“å‰æ’­æ”¾çš„éŸ³ä¹ä¿¡æ¯ */}
                    {uploadedAudios[currentIndex % uploadedAudios.length] && (
                      <div className="text-white text-sm mb-4 opacity-80">
                        ğŸµ {uploadedAudios[currentIndex % uploadedAudios.length].fileName}
                        {isAudioPlaying && (
                          <span className="ml-2 text-green-400">æ’­æ”¾ä¸­...</span>
                        )}
                      </div>
                    )}
                    
                    <div className="flex justify-center space-x-4">
                      <button
                        onClick={stopSOS}
                        className="bg-white text-black px-6 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors"
                      >
                        {t.stop}
                      </button>
                      {isAudioPlaying && (
                        <button
                          onClick={pauseAudio}
                          className="bg-yellow-500 text-white px-4 py-3 rounded-full font-semibold hover:bg-yellow-600 transition-colors"
                        >
                          {t.pause}
                        </button>
                      )}
                      {!isAudioPlaying && uploadedAudios.length > 0 && (
                        <button
                          onClick={resumeAudio}
                          className="bg-green-500 text-white px-4 py-3 rounded-full font-semibold hover:bg-green-600 transition-colors"
                        >
                          {t.resume}
                        </button>
                      )}
                    </div>
                  </div>
                </div>
                
                {/* è¿›åº¦æŒ‡ç¤ºå™¨ */}
                <div className="absolute top-4 right-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded-lg">
                  ğŸ“¸ {currentIndex + 1} / {allPhotos.length}
                </div>

                <div className="absolute top-4 left-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded-lg text-sm">
                  {photoDuration === 0 && t.permanent}
                  {photoDuration === 10 && `10 ${t.seconds}`}
                  {photoDuration === 20 && `20 ${t.seconds}`}
                  {photoDuration === 60 && `1 ${t.minute}`}
                  {photoDuration === 300 && `5 ${t.minutes}`}
                  {photoDuration === 1800 && `30 ${t.minutes}`}
                </div>
                
                {/* ç…§ç‰‡å¯¼èˆªæŒ‰é’® */}
                <button
                  onClick={() => setCurrentIndex((prev) => (prev - 1 + allPhotos.length) % allPhotos.length)}
                  className="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-70 transition-all"
                >
                  â†
                </button>
                <button
                  onClick={() => setCurrentIndex((prev) => (prev + 1) % allPhotos.length)}
                  className="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-70 transition-all"
                >
                  â†’
                </button>

                {/* éšè—çš„éŸ³é¢‘æ’­æ”¾å™¨ */}
                <audio 
                  ref={audioRef} 
                  style={{ display: 'none' }} 
                  onEnded={playNextAudio}
                  onPause={() => setIsAudioPlaying(false)}
                  onPlay={() => setIsAudioPlaying(true)}
                  preload="auto"
                />
              </div>
            );
          }

          // æ··åˆæ¨¡å¼ï¼šæ–‡å­—+éŸ³ä¹
          if (currentView === 'mixed-memory-audio') {
            if (allMemories.length === 0) {
              return (
                <div className="min-h-screen bg-gradient-to-br from-purple-100 to-pink-100 p-4 flex items-center justify-center">
                  <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-8 rounded-xl shadow-lg text-center max-w-md">
                    <MessageCircle className="w-16 h-16 text-pink-500 mx-auto mb-4" />
                    <h2 className="text-xl font-bold mb-4">
                      {language === 'zh' ? 'è¿˜æ²¡æœ‰å›å¿†è®°å½•' : 'No Memory Records'}
                    </h2>
                    <p className="text-gray-600 mb-6">
                      {language === 'zh' ? 
                        'è¯·å…ˆä¸Šä¼ ä¸€äº›ç¾å¥½å›å¿†æ¥ä½¿ç”¨æ­¤åŠŸèƒ½' : 
                        'Please upload some wonderful memories to use this feature'}
                    </p>
                    <button
                      onClick={() => setCurrentView('memories')}
                      className="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors"
                    >
                      {language === 'zh' ? 'å»ä¸Šä¼ å›å¿†' : 'Upload Memories'}
                    </button>
                  </div>
                </div>
              );
            }

            const currentMemory = allMemories[currentIndex] || allMemories[0];
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-100 to-pink-100 p-4 flex items-center justify-center">
                <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-8 rounded-xl shadow-lg text-center max-w-lg">
                  <MessageCircle className="w-16 h-16 text-pink-500 mx-auto mb-4" />
                  <h2 className="text-xl font-bold mb-4">{currentMemory.title[language]}</h2>
                  
                  {/* ç¾åŒ–çš„æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ */}
                  <div className="bg-gradient-to-r from-pink-100 to-rose-100 border border-pink-200 p-6 rounded-lg mb-4 max-h-64 overflow-y-auto">
                    <p className="text-gray-700 leading-relaxed whitespace-pre-wrap text-left">
                      {currentMemory.content[language]}
                    </p>
                  </div>
                  
                  {/* å½“å‰æ’­æ”¾çš„éŸ³ä¹ä¿¡æ¯ */}
                  {uploadedAudios[currentIndex % uploadedAudios.length] && (
                    <div className="bg-gradient-to-r from-green-100 to-blue-100 border border-green-200 p-3 rounded-lg mb-4">
                      <div className="text-sm text-gray-700">
                        ğŸµ {uploadedAudios[currentIndex % uploadedAudios.length].fileName}
                        {isAudioPlaying && (
                          <span className="ml-2 text-green-600 font-medium">
                            {language === 'zh' ? 'æ’­æ”¾ä¸­...' : 'Playing...'}
                          </span>
                        )}
                      </div>
                    </div>
                  )}
                  
                  {/* æ˜¾ç¤ºå½“å‰è¿›åº¦ */}
                  <p className="text-sm text-purple-600 mb-4">
                    {language === 'zh' ? 
                      `å›å¿†: ${currentIndex + 1} / ${allMemories.length}` : 
                      `Memory: ${currentIndex + 1} / ${allMemories.length}`}
                  </p>
                  
                  <div className="flex justify-center space-x-3 mb-4">
                    <button
                      onClick={stopSOS}
                      className="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors"
                    >
                      {language === 'zh' ? 'åœæ­¢' : 'Stop'}
                    </button>
                    {isAudioPlaying && (
                      <button
                        onClick={pauseAudio}
                        className="bg-yellow-500 text-white px-4 py-3 rounded-lg hover:bg-yellow-600 transition-colors"
                      >
                        {t.pause}
                      </button>
                    )}
                    {!isAudioPlaying && uploadedAudios.length > 0 && (
                      <button
                        onClick={resumeAudio}
                        className="bg-green-500 text-white px-4 py-3 rounded-lg hover:bg-green-600 transition-colors"
                      >
                        {t.resume}
                      </button>
                    )}
                  </div>

                  {/* æ‰‹åŠ¨åˆ‡æ¢æŒ‰é’® */}
                  {allMemories.length > 1 && (
                    <div className="flex justify-center space-x-2">
                      <button
                        onClick={() => {
                          const prevIndex = (currentIndex - 1 + allMemories.length) % allMemories.length;
                          setCurrentIndex(prevIndex);
                        }}
                        className="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition-colors"
                      >
                        {language === 'zh' ? 'â† ä¸Šä¸€ä¸ª' : 'â† Previous'}
                      </button>
                      <button
                        onClick={() => {
                          const nextIndex = (currentIndex + 1) % allMemories.length;
                          setCurrentIndex(nextIndex);
                        }}
                        className="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition-colors"
                      >
                        {language === 'zh' ? 'ä¸‹ä¸€ä¸ª â†’' : 'Next â†’'}
                      </button>
                    </div>
                  )}

                  {/* éšè—çš„éŸ³é¢‘æ’­æ”¾å™¨ */}
                  <audio 
                    ref={audioRef} 
                    style={{ display: 'none' }} 
                    onEnded={playNextAudio}
                    onPause={() => setIsAudioPlaying(false)}
                    onPlay={() => setIsAudioPlaying(true)}
                    preload="auto"
                  />
                </div>
              </div>
            );
          }

          // è®°å¿†å¹»ç¯ç‰‡è§†å›¾ - æ–°å¢SOSæ’­æ”¾æ¨¡å¼
          if (currentView === 'memories-slideshow') {
            if (allMemories.length === 0) {
              return (
                <div className="min-h-screen bg-gradient-to-br from-purple-100 to-pink-100 p-4 flex items-center justify-center">
                  <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-8 rounded-xl shadow-lg text-center max-w-md">
                    <MessageCircle className="w-16 h-16 text-pink-500 mx-auto mb-4" />
                    <h2 className="text-xl font-bold mb-4">
                      {language === 'zh' ? 'è¿˜æ²¡æœ‰å›å¿†è®°å½•' : 'No Memory Records'}
                    </h2>
                    <p className="text-gray-600 mb-6">
                      {language === 'zh' ? 
                        'è¯·å…ˆä¸Šä¼ ä¸€äº›ç¾å¥½å›å¿†æ¥ä½¿ç”¨æ­¤åŠŸèƒ½' : 
                        'Please upload some wonderful memories to use this feature'}
                    </p>
                    <button
                      onClick={() => setCurrentView('memories')}
                      className="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors"
                    >
                      {language === 'zh' ? 'å»ä¸Šä¼ å›å¿†' : 'Upload Memories'}
                    </button>
                  </div>
                </div>
              );
            }

            const currentMemory = allMemories[currentIndex] || allMemories[0];
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-100 to-pink-100 p-4 flex items-center justify-center">
                <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-8 rounded-xl shadow-lg text-center max-w-lg">
                  <MessageCircle className="w-16 h-16 text-pink-500 mx-auto mb-4" />
                  <h2 className="text-xl font-bold mb-4">{currentMemory.title[language]}</h2>
                  
                  {/* ç¾åŒ–çš„æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ */}
                  <div className="bg-gradient-to-r from-pink-100 to-rose-100 border border-pink-200 p-6 rounded-lg mb-6 max-h-64 overflow-y-auto">
                    <p className="text-gray-700 leading-relaxed whitespace-pre-wrap text-left">
                      {currentMemory.content[language]}
                    </p>
                  </div>
                  
                  {/* æ˜¾ç¤ºå½“å‰è¿›åº¦ */}
                  <p className="text-sm text-purple-600 mb-4">
                    {language === 'zh' ? 
                      `å›å¿†: ${currentIndex + 1} / ${allMemories.length}` : 
                      `Memory: ${currentIndex + 1} / ${allMemories.length}`}
                  </p>
                  
                  <div className="flex justify-center space-x-4 mb-4">
                    <button
                      onClick={stopSOS}
                      className="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors"
                    >
                      {language === 'zh' ? 'åœæ­¢' : 'Stop'}
                    </button>
                    <button
                      onClick={() => {
                        setCurrentView('main');
                      }}
                      className="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors"
                    >
                      {language === 'zh' ? 'è¿”å›' : 'Back'}
                    </button>
                  </div>

                  {/* æ‰‹åŠ¨åˆ‡æ¢æŒ‰é’® */}
                  {allMemories.length > 1 && (
                    <div className="flex justify-center space-x-2">
                      <button
                        onClick={() => {
                          const prevIndex = (currentIndex - 1 + allMemories.length) % allMemories.length;
                          setCurrentIndex(prevIndex);
                        }}
                        className="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition-colors"
                      >
                        {language === 'zh' ? 'â† ä¸Šä¸€ä¸ª' : 'â† Previous'}
                      </button>
                      <button
                        onClick={() => {
                          const nextIndex = (currentIndex + 1) % allMemories.length;
                          setCurrentIndex(nextIndex);
                        }}
                        className="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition-colors"
                      >
                        {language === 'zh' ? 'ä¸‹ä¸€ä¸ª â†’' : 'Next â†’'}
                      </button>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // è®°å¿†è§†å›¾ - å¢åŠ ä¸Šä¼ åŠŸèƒ½
          if (currentView === 'memories') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-100 to-pink-100 p-4">
                <div className="max-w-md mx-auto pt-8">
                  <div className="flex items-center justify-between mb-6">
                    <button
                      onClick={() => setCurrentView('main')}
                      className="text-purple-500 font-semibold"
                    >
                      {t.back}
                    </button>
                    <h2 className="text-xl font-bold text-center">{t.yourMemories}</h2>
                    <div></div>
                  </div>

                  {/* å¿ƒçµç¬”è®°åŒºåŸŸ - æ›¿ä»£æ–‡æ¡£ä¸Šä¼  */}
                  <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-6 rounded-xl shadow-md mb-6">
                    <h3 className="font-semibold mb-4 text-center">
                      {language === 'zh' ? 'âœ¨ å¿ƒçµç¬”è®° âœ¨' : 'âœ¨ Heart Notes âœ¨'}
                    </h3>
                    
                    {/* æ¸©æš–çš„ä½¿ç”¨è¯´æ˜ */}
                    <div className="bg-gradient-to-r from-pink-100 to-rose-100 border border-pink-200 p-4 rounded-lg mb-4">
                      <p className="text-sm text-gray-700 leading-relaxed text-center">
                        {language === 'zh' ? 
                          'ğŸ’ åœ¨è¿™é‡Œå†™ä¸‹é‚£äº›æ¸©æš–çš„è¯è¯­ï¼Œè®°å½•ç¾å¥½çš„æ—¶åˆ»ï¼Œæˆ–æ˜¯ç»™è‡ªå·±çš„é¼“åŠ±ã€‚åœ¨éœ€è¦çš„æ—¶å€™ï¼Œè¿™äº›æ–‡å­—ä¼šæˆä¸ºä½ å†…å¿ƒçš„å…‰èŠ’ã€‚' : 
                          'ğŸ’ Write warm words here, record beautiful moments, or give yourself encouragement. When needed, these words will become the light in your heart.'}
                      </p>
                    </div>
                    
                    <textarea
                      value={notepadContent}
                      onChange={(e) => setNotepadContent(e.target.value)}
                      placeholder={language === 'zh' ? 
                        'åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„ç¾å¥½å›å¿†ã€æˆå°±ã€æ„Ÿè°¢çš„è¯è¯­ï¼Œæˆ–ä»»ä½•èƒ½è®©ä½ æ„Ÿåˆ°æ¸©æš–çš„æ–‡å­—...\n\nä¾‹å¦‚ï¼š\nâ€¢ ä»Šå¤©æˆ‘å®Œæˆäº†ä¸€ä¸ªé‡è¦çš„é¡¹ç›®\nâ€¢ æœ‹å‹ç»™äº†æˆ‘å¾ˆå¤§çš„æ”¯æŒ\nâ€¢ æˆ‘æ¯”æ˜¨å¤©çš„è‡ªå·±æ›´å¼ºå¤§äº†' : 
                        'Write your beautiful memories, achievements, words of gratitude, or any text that makes you feel warm...\n\nFor example:\nâ€¢ Today I completed an important project\nâ€¢ Friends gave me great support\nâ€¢ I am stronger than yesterday'}
                      className="w-full h-48 p-4 border border-pink-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent bg-white shadow-inner"
                      style={{
                        fontFamily: 'system-ui, -apple-system, sans-serif',
                        fontSize: '14px',
                        lineHeight: '1.6'
                      }}
                    />
                    
                    <div className="mt-3 text-center">
                      <p className="text-xs text-gray-500">
                        {language === 'zh' ? 
                          `å·²å†™å…¥ ${notepadContent.length} ä¸ªå­—ç¬¦` : 
                          `${notepadContent.length} characters written`}
                      </p>
                    </div>
                  </div>

                  {/* å›å¿†åˆ—è¡¨ - ç®€åŒ–æ˜¾ç¤º */}
                  <div className="space-y-4">
                    <h4 className="font-semibold text-gray-800">
                      {language === 'zh' ? 'æ‰€æœ‰ç¾å¥½å›å¿†' : 'All Beautiful Memories'}
                    </h4>
                    {allMemories.map((memory, index) => (
                      <div 
                        key={memory.id} 
                        className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-4 rounded-xl shadow-md relative"
                      >
                        <div className="flex items-start justify-between">
                          <div className="flex-1">
                            <div className="flex items-center mb-2">
                              <span className="bg-pink-500 text-white text-sm px-3 py-1 rounded-full mr-3 flex-shrink-0">
                                {index + 1}
                              </span>
                              <h3 className="font-semibold text-lg">{memory.title[language]}</h3>
                            </div>
                            <p className="text-gray-700 text-sm leading-relaxed">{memory.content[language]}</p>
                          </div>
                          <div className="ml-2 flex-shrink-0">
                            {memory.isNotepad && (
                              <button
                                onClick={() => setNotepadContent('')}
                                className="bg-yellow-500 text-white px-3 py-1 rounded text-xs hover:bg-yellow-600 transition-colors"
                              >
                                {language === 'zh' ? 'æ¸…ç©º' : 'Clear'}
                              </button>
                            )}
                            {memory.isDefault && (
                              <button
                                onClick={() => setDefaultMemories(prev => prev.filter(m => m.id !== memory.id))}
                                className="bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 transition-colors"
                              >
                                {language === 'zh' ? 'åˆ é™¤' : 'Delete'}
                              </button>
                            )}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* ç©ºçŠ¶æ€ */}
                  {allMemories.length === 0 && (
                    <div className="text-center text-gray-500 mt-8">
                      <FileText className="w-12 h-12 mx-auto mb-4 text-gray-300" />
                      <p className="mb-2 font-medium">
                        {language === 'zh' ? 'è¿˜æ²¡æœ‰ä»»ä½•å›å¿†è®°å½•' : 'No memory records yet'}
                      </p>
                      <p className="text-sm px-4">
                        {language === 'zh' ? 
                          'å¼€å§‹è®°å½•é‚£äº›è®©ä½ æ„Ÿåˆ°éª„å‚²å’Œå¿«ä¹çš„æ—¶åˆ»å§' : 
                          'Start recording moments that make you feel proud and happy'}
                      </p>
                    </div>
                  )}

                  <button
                    onClick={stopSOS}
                    className="w-full mt-6 bg-purple-500 text-white py-3 rounded-lg font-semibold"
                  >
                    {t.returnHome}
                  </button>
                </div>
              </div>
            );
          }

          // éŸ³é¢‘ç®¡ç†è§†å›¾ - åŒ…å«æ–°çš„æ‹–æ‹½æ’åºåŠŸèƒ½
          if (currentView === 'audios') {
            return (
              <div className="min-h-screen bg-gray-50 p-4">
                <div className="max-w-md mx-auto">
                  <div className="flex items-center justify-between mb-6 pt-8">
                    <button
                      onClick={() => setCurrentView('main')}
                      className="text-blue-500 font-semibold"
                    >
                      {t.back}
                    </button>
                    <h2 className="text-xl font-bold">{t.supportSounds}</h2>
                    <div></div>
                  </div>

                  {/* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */}
                  <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-6 rounded-xl shadow-md mb-6">
                    <h3 className="font-semibold mb-4 text-center">
                      {language === 'zh' ? 'ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶' : 'Upload Audio Files'}
                    </h3>
                    
                    {/* æ¸©æš–çš„ä½¿ç”¨è¯´æ˜ */}
                    <div className="bg-gradient-to-r from-pink-100 to-rose-100 border border-pink-200 p-4 rounded-lg mb-4">
                      <p className="text-sm text-gray-700 leading-relaxed text-center">
                        {language === 'zh' ? 
                          'ğŸ’ ä½¿ç”¨æ‰‹æœºå½•éŸ³è®°å½•å®¶äººæœ‹å‹çš„æ¸©æš–è¯è¯­ï¼Œæˆ–ä¸Šä¼ è®©ä½ æ„Ÿåˆ°å®‰å¿ƒçš„éŸ³ä¹ã€‚åœ¨ç´§å¼ ç„¦è™‘æ—¶ï¼Œè¿™äº›ç†Ÿæ‚‰çš„å£°éŸ³ä¼šåƒæ‹¥æŠ±ä¸€æ ·é™ªä¼´ä½ ï¼Œæé†’ä½ å¹¶ä¸å­¤å•ã€‚' : 
                          'ğŸ’ Record warm words from family and friends, or upload music that brings you comfort. During anxious moments, these familiar sounds will embrace you like a hug, reminding you that you are not alone.'}
                      </p>
                    </div>
                    
                    <p className="text-sm text-gray-600 mb-4 text-center">
                      {language === 'zh' ? 
                        'æ”¯æŒæ ¼å¼: MP3, MP4, WAV, FLAC, AAC, AMR, OGG, M4A' : 
                        'Supported: MP3, MP4, WAV, FLAC, AAC, AMR, OGG, M4A'}
                    </p>
                    
                    <div className="relative">
                      <input
                        type="file"
                        accept="audio/*,.mp3,.mp4,.wav,.flac,.aac,.amr,.ogg,.m4a,.wma"
                        multiple
                        onChange={(e) => {
                          const files = Array.from(e.target.files);
                          files.forEach((file, index) => {
                            const url = URL.createObjectURL(file);
                            const newAudio = {
                              id: Date.now() + index,
                              fileName: file.name,
                              audioUrl: url,
                              fileSize: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                              fileType: file.type || 'Unknown'
                            };
                            setUploadedAudios(prev => [...prev, newAudio]);
                          });
                          e.target.value = ''; // æ¸…ç©ºè¾“å…¥ï¼Œå…è®¸é‡å¤ä¸Šä¼ ç›¸åŒæ–‡ä»¶
                        }}
                        className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                        id="audioUpload"
                      />
                      <label 
                        htmlFor="audioUpload"
                        className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-pink-300 rounded-lg cursor-pointer hover:border-pink-500 hover:bg-pink-100 transition-all"
                      >
                        <Mic className="w-8 h-8 text-gray-400 mb-2" />
                        <p className="text-sm text-gray-600 text-center px-4">
                          {language === 'zh' ? 
                            'ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶æˆ–æ‹–æ‹½åˆ°è¿™é‡Œ' : 
                            'Click to select audio files or drag them here'}
                        </p>
                      </label>
                    </div>
                  </div>

                  {/* éŸ³é¢‘åˆ—è¡¨ - åŒ…å«æ‹–æ‹½æ’åºåŠŸèƒ½ */}
                  {uploadedAudios.length > 0 && (
                    <div className="space-y-4">
                      <h4 className="font-semibold text-gray-800">
                        {language === 'zh' ? 'å·²ä¸Šä¼ çš„éŸ³é¢‘æ–‡ä»¶ (æ‹–æ‹½é‡æ–°æ’åº)' : 'Uploaded Audio Files (Drag to Reorder)'}
                      </h4>
                      {uploadedAudios.map((audio, index) => (
                        <div 
                          key={audio.id} 
                          draggable
                          onDragStart={(e) => handleDragStart(e, index, 'audio')}
                          onDragOver={(e) => handleDragOver(e, index)}
                          onDragLeave={handleDragLeave}
                          onDrop={(e) => handleDrop(e, index, 'audio')}
                          onDragEnd={handleDragEnd}
                          className={`bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-4 rounded-xl shadow-md cursor-move transition-all duration-200 ${
                            draggedItem && draggedItem.index === index && draggedItem.type === 'audio' ? 'opacity-50 scale-95' : ''
                          } ${
                            dragOverIndex === index && draggedItem !== null && draggedItem.type === 'audio' && draggedItem.index !== index 
                              ? 'border-2 border-pink-400 border-dashed transform scale-105' 
                              : 'border-pink-100'
                          }`}
                        >
                          <div className="flex items-center justify-between mb-2">
                            <div className="flex items-center flex-1 min-w-0">
                              <div className="flex-1 min-w-0">
                                <div className="flex items-center">
                                  <span className="bg-pink-500 text-white text-sm px-3 py-1 rounded-full mr-3 flex-shrink-0">
                                    {index + 1}
                                  </span>
                                  <p className="font-semibold text-sm truncate">{audio.fileName}</p>
                                </div>
                                <p className="text-xs text-gray-500 mt-1">{audio.fileSize} â€¢ {audio.fileType}</p>
                              </div>
                            </div>
                            <div className="flex flex-col space-y-2 ml-2 flex-shrink-0">
                              <div className="flex space-x-2">
                                <button
                                  onClick={() => playAudio(audio.audioUrl)}
                                  className="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors"
                                >
                                  {language === 'zh' ? 'æ’­æ”¾' : 'Play'}
                                </button>
                                {isAudioPlaying && (
                                  <button
                                    onClick={stopAudio}
                                    className="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 transition-colors"
                                  >
                                    {language === 'zh' ? 'åœæ­¢' : 'Stop'}
                                  </button>
                                )}
                              </div>
                              <div className="flex space-x-2">
                                {index > 0 && (
                                  <button
                                    onClick={() => {
                                      const newAudios = [...uploadedAudios];
                                      const temp = newAudios[index];
                                      newAudios[index] = newAudios[index - 1];
                                      newAudios[index - 1] = temp;
                                      setUploadedAudios(newAudios);
                                    }}
                                    className="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 transition-colors"
                                  >
                                    â†‘
                                  </button>
                                )}
                                {index < uploadedAudios.length - 1 && (
                                  <button
                                    onClick={() => {
                                      const newAudios = [...uploadedAudios];
                                      const temp = newAudios[index];
                                      newAudios[index] = newAudios[index + 1];
                                      newAudios[index + 1] = temp;
                                      setUploadedAudios(newAudios);
                                    }}
                                    className="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 transition-colors"
                                  >
                                    â†“
                                  </button>
                                )}
                                <button
                                  onClick={() => {
                                    setUploadedAudios(prev => prev.filter(a => a.id !== audio.id));
                                    URL.revokeObjectURL(audio.audioUrl);
                                  }}
                                  className="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 transition-colors"
                                >
                                  åˆ 
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}

                  {/* ç©ºçŠ¶æ€ */}
                  {uploadedAudios.length === 0 && (
                    <div className="text-center text-gray-500 mt-8">
                      <Mic className="w-12 h-12 mx-auto mb-4 text-gray-300" />
                      <p className="mb-2 font-medium">
                        {language === 'zh' ? 'è¿˜æ²¡æœ‰ä¸Šä¼ ä»»ä½•éŸ³é¢‘æ–‡ä»¶' : 'No audio files uploaded yet'}
                      </p>
                      <p className="text-sm px-4">
                        {language === 'zh' ? 
                          'å¼€å§‹æ”¶é›†é‚£äº›èƒ½ç»™ä½ åŠ›é‡çš„å£°éŸ³å§ - ä¹Ÿè®¸æ˜¯å¦ˆå¦ˆçš„å®å’›ï¼Œæœ‹å‹çš„é¼“åŠ±ï¼Œæˆ–æ˜¯ä½ æœ€çˆ±çš„æ­Œæ›²' : 
                          'Start collecting sounds that give you strength - maybe mom\'s caring words, a friend\'s encouragement, or your favorite song'}
                      </p>
                    </div>
                  )}

                  {/* éšè—çš„éŸ³é¢‘æ’­æ”¾å™¨ */}
                  <audio 
                    ref={audioRef} 
                    style={{ display: 'none' }} 
                    onEnded={() => setIsAudioPlaying(false)}
                    onPause={() => setIsAudioPlaying(false)}
                    onPlay={() => setIsAudioPlaying(true)}
                    preload="auto" // é¢„åŠ è½½éŸ³é¢‘ä»¥å‡å°‘å»¶è¿Ÿ
                  />
                </div>
              </div>
            );
          }

          // SOSéŸ³é¢‘æ’­æ”¾è§†å›¾
          if (currentView === 'audio') {
            if (uploadedAudios.length === 0) {
              return (
                <div className="min-h-screen bg-gradient-to-br from-green-100 to-blue-100 p-4 flex items-center justify-center">
                  <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-8 rounded-xl shadow-lg text-center max-w-md">
                    <Mic className="w-16 h-16 text-pink-500 mx-auto mb-4" />
                    <h2 className="text-xl font-bold mb-4">
                      {language === 'zh' ? 'è¿˜æ²¡æœ‰éŸ³é¢‘æ–‡ä»¶' : 'No Audio Files'}
                    </h2>
                    <p className="text-gray-600 mb-6">
                      {language === 'zh' ? 
                        'è¯·å…ˆä¸Šä¼ ä¸€äº›éŸ³é¢‘æ–‡ä»¶æ¥ä½¿ç”¨è¯­éŸ³åŠŸèƒ½' : 
                        'Please upload some audio files to use voice feature'}
                    </p>
                    <button
                      onClick={() => setCurrentView('audios')}
                      className="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors"
                    >
                      {language === 'zh' ? 'å»ä¸Šä¼ æ–‡ä»¶' : 'Upload Files'}
                    </button>
                  </div>
                </div>
              );
            }

            const currentAudio = uploadedAudios[currentIndex] || uploadedAudios[0];
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-100 to-blue-100 p-4 flex items-center justify-center">
                <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-8 rounded-xl shadow-lg text-center max-w-md">
                  <Mic className="w-16 h-16 text-pink-500 mx-auto mb-4" />
                  <h2 className="text-xl font-bold mb-4">{currentAudio.fileName}</h2>
                  <p className="text-sm text-gray-500 mb-2">{currentAudio.fileSize}</p>
                  
                  {/* æ˜¾ç¤ºå½“å‰æ’­æ”¾è¿›åº¦ */}
                  <p className="text-sm text-blue-600 mb-4">
                    {language === 'zh' ? 
                      `æ’­æ”¾è¿›åº¦: ${currentIndex + 1} / ${uploadedAudios.length}` : 
                      `Playing: ${currentIndex + 1} / ${uploadedAudios.length}`}
                  </p>
                  
                  {/* æ˜¾ç¤ºæ’­æ”¾çŠ¶æ€ */}
                  {isAudioPlaying && (
                    <div className="mb-4 text-green-600">
                      <p className="text-sm">
                        {language === 'zh' ? 'ğŸµ æ­£åœ¨æ’­æ”¾...' : 'ğŸµ Playing...'}
                      </p>
                    </div>
                  )}
                  
                  <div className="flex justify-center space-x-4 mb-4">
                    {!isAudioPlaying && (
                      <button
                        onClick={() => {
                          if (audioRef.current && currentAudio.audioUrl) {
                            audioRef.current.src = currentAudio.audioUrl;
                            audioRef.current.play().then(() => {
                              setIsAudioPlaying(true);
                            });
                          }
                        }}
                        className="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors"
                      >
                        {language === 'zh' ? 'æ’­æ”¾' : 'Play'}
                      </button>
                    )}
                    {isAudioPlaying && (
                      <button
                        onClick={stopAudio}
                        className="bg-yellow-500 text-white px-6 py-3 rounded-lg hover:bg-yellow-600 transition-colors"
                      >
                        {language === 'zh' ? 'åœæ­¢' : 'Stop'}
                      </button>
                    )}
                    <button
                      onClick={() => {
                        // ç¡®ä¿åœæ­¢éŸ³é¢‘å¹¶é‡ç½®çŠ¶æ€
                        if (audioRef.current) {
                          audioRef.current.pause();
                          audioRef.current.currentTime = 0;
                          setIsAudioPlaying(false);
                        }
                        setCurrentView('main');
                      }}
                      className="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors"
                    >
                      {language === 'zh' ? 'è¿”å›' : 'Back'}
                    </button>
                  </div>

                  {/* æ‰‹åŠ¨åˆ‡æ¢æŒ‰é’® */}
                  {uploadedAudios.length > 1 && (
                    <div className="flex justify-center space-x-2">
                      <button
                        onClick={() => {
                          const prevIndex = (currentIndex - 1 + uploadedAudios.length) % uploadedAudios.length;
                          setCurrentIndex(prevIndex);
                          const prevAudio = uploadedAudios[prevIndex];
                          if (prevAudio && audioRef.current) {
                            // ç«‹å³åˆ‡æ¢ï¼Œæ— å»¶è¿Ÿ
                            audioRef.current.src = prevAudio.audioUrl;
                            audioRef.current.play();
                          }
                        }}
                        className="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition-colors"
                      >
                        {language === 'zh' ? 'â† ä¸Šä¸€é¦–' : 'â† Previous'}
                      </button>
                      <button
                        onClick={() => {
                          // ç«‹å³æ’­æ”¾ä¸‹ä¸€é¦–
                          playNextAudio();
                        }}
                        className="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition-colors"
                      >
                        {language === 'zh' ? 'ä¸‹ä¸€é¦– â†’' : 'Next â†’'}
                      </button>
                    </div>
                  )}

                  <audio 
                    ref={audioRef} 
                    style={{ display: 'none' }} 
                    onEnded={playNextAudio} // éŸ³é¢‘ç»“æŸç«‹å³æ’­æ”¾ä¸‹ä¸€é¦–
                    onPause={() => setIsAudioPlaying(false)}
                    onPlay={() => setIsAudioPlaying(true)}
                    preload="auto" // é¢„åŠ è½½éŸ³é¢‘ä»¥å‡å°‘å»¶è¿Ÿ
                  />
                </div>
              </div>
            );
          }

          // ç…§ç‰‡ç®¡ç†è§†å›¾ - å¢åŠ ä¸Šä¼ åŠŸèƒ½
          if (currentView === 'photos') {
            return (
              <div className="min-h-screen bg-gray-50 p-4">
                <div className="max-w-md mx-auto">
                  <div className="flex items-center justify-between mb-6 pt-8">
                    <button
                      onClick={() => setCurrentView('main')}
                      className="text-blue-500 font-semibold"
                    >
                      {t.back}
                    </button>
                    <h2 className="text-xl font-bold">{t.safePhotos}</h2>
                    <div></div>
                  </div>

                  {/* ç…§ç‰‡ä¸Šä¼ åŒºåŸŸ */}
                  <div className="bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 p-6 rounded-xl shadow-md mb-6">
                    <h3 className="font-semibold mb-4 text-center">
                      {language === 'zh' ? 'ä¸Šä¼ å®‰å…¨ç…§ç‰‡' : 'Upload Safe Photos'}
                    </h3>
                    
                    {/* æ¸©æš–çš„ä½¿ç”¨è¯´æ˜ */}
                    <div className="bg-gradient-to-r from-pink-100 to-rose-100 border border-pink-200 p-4 rounded-lg mb-4">
                      <p className="text-sm text-gray-700 leading-relaxed text-center">
                        {language === 'zh' ? 
                          'ğŸ“· ä¸Šä¼ é‚£äº›è®©ä½ æ„Ÿåˆ°å®‰å…¨å’Œå¿«ä¹çš„ç…§ç‰‡ - å®¶äººçš„ç¬‘å®¹ã€æœ‹å‹çš„é™ªä¼´ã€ç¾ä¸½çš„é£æ™¯ï¼Œæˆ–ä»»ä½•èƒ½å¸¦ç»™ä½ æ¸©æš–å›å¿†çš„ç¬é—´ã€‚' : 
                          'ğŸ“· Upload photos that make you feel safe and happy - family smiles, friends\' company, beautiful scenery, or any moments that bring you warm memories.'}
                      </p>
                    </div>
                    
                    <p className="text-sm text-gray-600 mb-4 text-center">
                      {language === 'zh' ? 
                        'æ”¯æŒæ ¼å¼: JPG, PNG, GIF, WEBP, BMP' : 
                        'Supported: JPG, PNG, GIF, WEBP, BMP'}
                    </p>
                    
                    <div className="relative">
                      <input
                        type="file"
                        accept="image/*,.jpg,.jpeg,.png,.gif,.webp,.bmp"
                        multiple
                        onChange={(e) => {
                          const files = Array.from(e.target.files);
                          files.forEach((file, index) => {
                            const url = URL.createObjectURL(file);
                            const newPhoto = {
                              id: Date.now() + index,
                              fileName: file.name,
                              url: url,
                              fileSize: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                              description: { 
                                zh: file.name.replace(/\.[^/.]+$/, ""), 
                                en: file.name.replace(/\.[^/.]+$/, "") 
                              },
                              isDefault: false
                            };
                            setUploadedPhotos(prev => [...prev, newPhoto]);
                          });
                          e.target.value = '';
                        }}
                        className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                        id="photoUpload"
                      />
                      <label 
                        htmlFor="photoUpload"
                        className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-pink-300 rounded-lg cursor-pointer hover:border-pink-500 hover:bg-pink-100 transition-all"
                      >
                        <Camera className="w-8 h-8 text-gray-400 mb-2" />
                        <p className="text-sm text-gray-600 text-center px-4">
                          {language === 'zh' ? 
                            'ç‚¹å‡»é€‰æ‹©ç…§ç‰‡æˆ–æ‹–æ‹½åˆ°è¿™é‡Œ' : 
                            'Click to select photos or drag them here'}
                        </p>
                      </label>
                    </div>
                  </div>

                  {/* ç…§ç‰‡ç½‘æ ¼æ˜¾ç¤º - æ·»åŠ æ‹–æ‹½åŠŸèƒ½ */}
                  <h4 className="font-semibold text-gray-800 mb-4">
                    {language === 'zh' ? 'æ‰€æœ‰ç…§ç‰‡ (æ‹–æ‹½é‡æ–°æ’åº)' : 'All Photos (Drag to Reorder)'}
                  </h4>
                  <div className="grid grid-cols-2 gap-4">
                    {allPhotos.map((photo, index) => (
                      <div 
                        key={photo.id} 
                        draggable
                        onDragStart={(e) => handleDragStart(e, index, 'photo')}
                        onDragOver={(e) => handleDragOver(e, index)}
                        onDragLeave={handleDragLeave}
                        onDrop={(e) => handleDrop(e, index, 'photo')}
                        onDragEnd={handleDragEnd}
                        className={`relative cursor-move transition-all duration-200 ${
                          draggedItem && draggedItem.index === index && draggedItem.type === 'photo' ? 'opacity-50 scale-95' : ''
                        } ${
                          dragOverIndex === index && draggedItem !== null && draggedItem.type === 'photo' && draggedItem.index !== index 
                            ? 'border-2 border-pink-400 border-dashed transform scale-105 rounded-lg' 
                            : ''
                        }`}
                      >
                        <img
                          src={photo.url}
                          alt={photo.description[language]}
                          className="w-full object-cover rounded-lg"
                          style={{
                            height: 'auto',
                            aspectRatio: '4/3',
                            maxHeight: '200px'
                          }}
                        />
                        <div className="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2 rounded-b-lg">
                          <div className="flex items-center justify-between">
                            <div className="flex items-center flex-1 min-w-0">
                              <span className="bg-pink-500 text-white text-xs px-2 py-1 rounded-full mr-2 flex-shrink-0">
                                {index + 1}
                              </span>
                              <p className="text-xs truncate">{photo.description[language]}</p>
                            </div>
                            <div className="flex space-x-1 ml-2 flex-shrink-0">
                              {index > 0 && (
                                <button
                                  onClick={() => {
                                    const newPhotos = [...allPhotos];
                                    const temp = newPhotos[index];
                                    newPhotos[index] = newPhotos[index - 1];
                                    newPhotos[index - 1] = temp;
                                    // æ›´æ–°ç”¨æˆ·ç…§ç‰‡çŠ¶æ€
                                    const userPhotos = newPhotos.filter(p => !p.isDefault);
                                    setUploadedPhotos(userPhotos);
                                  }}
                                  className="bg-blue-500 text-white w-6 h-6 rounded text-xs hover:bg-blue-600 transition-colors flex items-center justify-center"
                                >
                                  â†‘
                                </button>
                              )}
                              {index < allPhotos.length - 1 && (
                                <button
                                  onClick={() => {
                                    const newPhotos = [...allPhotos];
                                    const temp = newPhotos[index];
                                    newPhotos[index] = newPhotos[index + 1];
                                    newPhotos[index + 1] = temp;
                                    // æ›´æ–°ç”¨æˆ·ç…§ç‰‡çŠ¶æ€
                                    const userPhotos = newPhotos.filter(p => !p.isDefault);
                                    setUploadedPhotos(userPhotos);
                                  }}
                                  className="bg-blue-500 text-white w-6 h-6 rounded text-xs hover:bg-blue-600 transition-colors flex items-center justify-center"
                                >
                                  â†“
                                </button>
                              )}
                              <button
                                onClick={() => {
                                  if (photo.isDefault) {
                                    setDefaultPhotos(prev => prev.filter(p => p.id !== photo.id));
                                  } else {
                                    setUploadedPhotos(prev => prev.filter(p => p.id !== photo.id));
                                    URL.revokeObjectURL(photo.url);
                                  }
                                }}
                                className="bg-red-500 text-white w-6 h-6 rounded text-xs hover:bg-red-600 transition-colors flex items-center justify-center"
                              >
                                Ã—
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* ç©ºçŠ¶æ€ */}
                  {allPhotos.length === 0 && (
                    <div className="text-center text-gray-500 mt-8">
                      <Camera className="w-12 h-12 mx-auto mb-4 text-gray-300" />
                      <p className="mb-2 font-medium">
                        {language === 'zh' ? 'è¿˜æ²¡æœ‰ä»»ä½•ç…§ç‰‡' : 'No photos yet'}
                      </p>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          return null;
        };

        ReactDOM.render(React.createElement(EmotionalSupportApp), document.getElementById('root'));
    </script>
</body>
</html>